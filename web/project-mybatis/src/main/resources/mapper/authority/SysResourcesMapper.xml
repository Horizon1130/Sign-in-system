<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.myway.platform.mysql.authority.mapper.SysResourcesDao">

    <select id="getResources" resultType="java.util.Map" parameterType="com.myway.platform.mysql.authority.entity.SysResources">
        SELECT
            resource.*, (
                SELECT
                    title
                FROM
                    t_sys_resources parent
                WHERE
                    parent.classify = 'CATALOG'
                AND parent.resource_id = resource.parent_id
            ) parent_title
        FROM
            t_sys_resources resource
        <where>
            AND classify IN ('CATALOG', 'MENU')
            <if test="record != null">
                <if test="record.title != null and record.title != ''">
                    AND title like CONCAT('%',#{record.title},'%')
                </if>
                <if test="record.status != null">
                    AND status = #{record.status}
                </if>
                <if test="record.classify != null and record.classify != ''">
                    AND classify = #{record.classify}
                </if>
                <if test="record.visible != null">
                    AND visible = #{record.visible}
                </if>
            </if>
        </where>
        ORDER BY
            classify,
            sort
    </select>
    <select id="getResourceButtons" resultType="java.util.Map">
        SELECT
            resource.*, (
                SELECT
                title
                FROM
                t_sys_resources parent
                WHERE
                parent.classify = 'MENU'
                AND parent.resource_id = resource.parent_id
            ) parent_title
            FROM
        t_sys_resources resource
        <where>
            AND classify = 'BUTTON'
            <if test="record != null">
                <if test="record.parentId != null and record.parentId != ''">
                    AND parent_id = #{record.parentId}
                </if>
                <if test="record.status != null">
                    AND status = #{record.status}
                </if>
                <if test="record.url != null and record.url != ''">
                    AND url = #{record.url}
                </if>
                <if test="record.visible != null">
                    AND visible = #{record.visible}
                </if>
            </if>
        </where>
        ORDER BY
        parent_id,
        sort
    </select>
</mapper>
